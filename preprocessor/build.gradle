apply plugin: 'antlr'

ext.antlr = [
        grammarpackage: "com.tazadum.glsl.preprocessor.parser",
        antlrSource   : 'src/main/antlr',
        destinationDir: "src/generated-sources/java"
]

dependencies {
<<<<<<< HEAD
    compile "net.sf.jopt-simple:jopt-simple:5.0.4"
    compile "org.antlr:antlr4-runtime:${antlrVersion}"
=======
	     api "net.sf.jopt-simple:jopt-simple:5.0.+"
	     implementation "org.antlr:antlr4-runtime:${antlrVersion}"
>>>>>>> 6f70f82... Fixing build

	antlr "org.antlr:antlr4:${antlrVersion}"

	testImplementation project(':test-util')
}

// work around for https://github.com/gradle/gradle/issues/820
configurations {
	compile {
		extendsFrom = extendsFrom.findAll { it != configurations.antlr }
	}
}

generateGrammarSource {
	arguments += ['-package', antlr.grammarpackage, '-visitor']
	outputDirectory = file("${projectDir}/generated-src/com/tazadum/glsl/preprocessor/parser")
}

task cleanAntlr(type: Delete) {
	delete file("${projectDir}/generated-src")
}
clean.dependsOn cleanAntlr

sourceSets.main.java.srcDirs += file("${projectDir}/generated-src")
