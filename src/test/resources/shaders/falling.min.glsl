vec3 s=vec3(.02,0.,0.),v=vec3(.01,.1,.15),r=vec3(.99,.94,.9),p=vec3(.3,.03,.01),g=vec3(.38,.531,-.758);vec2 i=vec2(2501.,3400.);float b=0.;vec3 f=vec3(0.);bool m;float x(vec3 g,vec2 s){vec3 v=abs(g);return max(v.g-s.g,max(.866025*v.r+.5*g.b,-g.b)-.5*s.r);}float x(float v){return fract(sin(v)*43758.5);}float n(vec3 v){vec3 s=floor(v),r=fract(v);r=r*r*(3.-2.*r);float g=s.r+57.*s.g+113.*s.b;return mix(mix(mix(x(g),x(g+1.),r.r),mix(x(g+57.),x(g+58.),r.r),r.g),mix(mix(x(g+113.),x(g+114.),r.r),mix(x(g+170.),x(g+171.),r.r),r.g),r.b);}mat3 a=mat3(0.,.8,.6,-.8,.3,-.4,-.6,-.4,.6);float n(vec3 r,float g){float v=.5*n(r);r=a*r*2.1+g;v+=.21*n(r);r=a*r*2.2+g;v+=.12*n(r);r=a*r*2.3+g;v+=.063*n(r);return v;}vec4 t(vec3 r){return vec4(1,1,1,smoothstep(0.,1.,pow(n(.001*r+vec3(2,4.2,0),0.),2.)-.3));}float w(vec3 r){float g=.2*iGlobalTime;vec3 v=.15*r+g;v.g=0.;return.5*n(v,g)+.0025*n(32.*v)+.5*sin(.1*r.b+5.*g+.01*r.r)+.05*sin(.44*r.b+g);}vec4 t(vec3 r,vec3 s){vec4 v=vec4(0.);vec2 m=(i-r.g)/s.g;float a=(m.g-m.r)/float(60),p=clamp(20000./(m.r+b),0.,1.);for(int f=0;f<60;f++){if(v.a<1.){vec3 n=r+m.r*s;vec4 e=t(n),d=t(n+400.*g);e.rgb*=1.-.25*smoothstep(0.,1.,10.*d.a);e.rgb*=1.-.0001*(i.g-n.g);e.a*=p;e.rgb*=e.a;v+=e*(1.-v.a);m.r+=a;}}vec3 f=mix(vec3(.8,.9,1.2),vec3(.08,.25,.5),.45+s.g);v.rgb=mix(f,v.rgb/(.01+v.a),v.a*p);return v;}vec2 n(vec3 v,float r,int g){vec2 i=vec2(15000.*float(g));if(g<1){float m=smoothstep(0.,1.,200./r);i.r=v.g+n(.01*vec3(v.r,0.,v.b)+iGlobalTime)+(1.-m)*.1*n(.1*vec3(v.r,0.,v.b));i.r=abs(i.r+(m>.01?m*w(v):0.));i.g=.5;}float f=8.+.5*sin(iGlobalTime);if(dot(v,v)<4e+06){float m=n(20.*floor(vec3(v.r,0.,v.b)/128.));f+=200.*smoothstep(0.,1.,m)-3.;v.rb=mod(v.rb,vec2(128.))-64.;}float m=min(max(x(v+vec3(0,f,0),vec2(20,11)),-x(v+vec3(5,f,-5),vec2(10,12))),x(v+vec3(5.5,f+.5*sin(4.+iGlobalTime),-5.5),vec2(5,11)));return m<i.r?vec2(m,1.5):i;}vec3 t(vec3 v,float r,float g){return normalize(vec3(n(v+g*s.rgb,r,0).r-n(v-g*s.rgb,r,0).r,n(v+g*s.grb,r,0).r-n(v-g*s.gbr,r,0).r,n(v+g*s.gbr,r,0).r-n(v-g*s.gbr,r,0).r));}vec3 w(vec3 v,vec3 r,int g){vec3 m=vec3(0.,.1,0.);for(int f=0;f<60;f++){if(abs(m.g)>s.r&&m.r<15000.)m.r+=m.g,m.gb=n(v+r*m.r,m.r,g);}if(g<1&&(m.r>15000.||m.g>1.))m.r=-v.g/r.g,m.g=10.,m.b=.5;return m;}vec3 d(float g){return vec3(2.,2.,.8)*(.1+g);}vec3 d(vec3 i,vec3 s,vec3 n){vec4 a=vec4(0);vec3 e=s+(i.r-.05)*n,c=t(e,i.r,1.);float l=m?1.:-1.,x=max(0.,dot(g,c)*l);b+=i.r;if(i.b>1.)return mix(v,d(x),m?1.:exp(-.0002*pow(i.r,1.6)));vec3 o=reflect(n,c),T=normalize(g-n);float G=m?.75:1.33,u=abs(dot(n,c)),h=1.-G*G*(1.-u*u);vec3 z=v*(1.-max(0.,-o.g)),R=v;if(h>0.){vec3 q=normalize(G*n+(G*u-sqrt(h))*l*c),Z=w(e,q,1);if(Z.b>1.&&Z.r<15000.){vec3 Y=e+q*Z.r;R=d(max(0.,dot(g,t(Y,Z.r,1.))))*exp(.5*p*Y.g);}else{R=vec3(0.,.01,.05);if(!m)a=t(e,q),R=a.rgb+(1.-a.a)*f;}}float q=.02+.98*pow(1.-u,2.);if(q>.01){vec3 Z=w(e,o,1);if(Z.b>.1&&Z.r<15000.&&dot(o,vec3(0,1,0))>.05)z=mix(v,d(max(0.,dot(g,t(e+o*Z.r,Z.r,1.)))),m?1.:exp(-.0002*pow(i.r+Z.r,1.6)));else if(m)a=t(e,o),z=.75*a.rgb+(1.-a.a)*(r+(1.-r)*pow(1.-max(0.,dot(g,T)),5.))*pow(max(0.,dot(c,T)),64.)*x*(12.-.008*s.g);}return q*z+(1.-q)*R;}void d(out vec4 i,in vec2 s){vec2 e=-1.+2.*s.rg/iResolution.rg;e.r*=iResolution.r/iResolution.g;float n=2.*smoothstep(0.,1.,iGlobalTime*.04),b=smoothstep(0.,1.,(iGlobalTime-25.)*.08),c=smoothstep(0.,1.,(iGlobalTime-35.)*.06),a=smoothstep(0.,1.,(iGlobalTime-45.)*.12),R=clamp(iGlobalTime-25.,0.,10.);vec2 Z=vec2(1.2+n-.35*sin(3.14*c),.75-.3*n-.3*(smoothstep(0.,1.,(iGlobalTime-20.)*.1)-b)+.25*sin(3.14*smoothstep(0.,1.,(iGlobalTime-35.)*.2))-.3*c+.3*a*a+.5*smoothstep(0.,1.,(iGlobalTime-55.)*.1));vec3 q=vec3(440.*c-128.,111.-125.*b+5.*clamp(iGlobalTime-35.,0.,5.)+80.*c-80.*a-100.*clamp(iGlobalTime-54.8,0.,.3)-10.*clamp(iGlobalTime-55.1,0.,15.),5178.-500.*R+10.*R*R-1038.*c),o=normalize(vec3(sin(Z.r),Z.g,cos(Z.r))),l=cross(o,vec3(0,-1.,0.)),T=normalize(o+.5*(e.r*l+e.g*cross(o,l)));float x=w(q);vec3 G=v,h=w(q,T,0);vec4 z=vec4(0);m=q.g>=x;float Y=max(0.,dot(g,T));f=r*min(4.*pow(Y,2048.)+pow(Y,32.),1.);if(h.r>0.)G=d(h,q,T);else if(m)z=t(q,T),G=z.rgb;if(m&&Y>0.){vec2 u=vec2(dot(g,l),g.g),X=e-u;X=X*length(X);r*=.1*pow(Y,6.);G+=r*25.*pow(max(0.,1.-2.*length(u*2.+X)),10.)*vec3(1.,.4,.2);G+=r*10.*pow(max(0.,1.-length(u*5.+mix(X,e,-2.1))),4.);}G=m?G+f*(1.-z.a):G*exp(-p*(x-q.g))*min(1.+T.g,1.);G+=smoothstep(0.,1.,1.-.1*iGlobalTime);G*=1.-smoothstep(0.,1.,.2*iGlobalTime-12.3);G=pow(min(G,1.),vec3(.44));i=vec4(G*G*(3.-2.*G),0.);}