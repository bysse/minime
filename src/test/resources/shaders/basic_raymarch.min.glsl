uniform vec3 v;uniform float b;const vec4 m=vec4(0.,0.,0.,1.);const int n=40;float s(vec3 v,vec3 b){vec3 m=abs(v)-b;return min(max(m.r,max(m.g,m.b)),0.)+length(max(m,0.));}float s(vec3 v){vec3 n=vec3(5.);return max(-(length(v-m.rgb)-m.a),s(v,vec3(.8)));}vec3 x(vec3 v){const vec3 m=vec3(.0001,0.,0.);float n=s(v+m.rgb)-s(v-m.rgb),r=s(v+m.grb)-s(v-m.gbr),b=s(v+m.gbr)-s(v-m.gbr);return normalize(vec3(n,r,b));}vec3 x(vec3 v,vec3 b){float m=0.,r=.1;vec3 c=v;for(int f=0;f<n;f++){c=v+m*b;r=s(c);if(abs(r)<=.0001)return x(c);m+=r;}return vec3(0.);}void e(out vec4 m,in vec2 c){vec2 n=-1.+2.*(c.rg/v.rg);n.r*=v.r/v.g;vec3 r=vec3(cos(b)*3.,sin(b)*3.,-3.),s=vec3(0.,0.,0.),a=normalize(s-r),f=cross(vec3(0.,1.,0.),a),g=cross(a,f),i=r+a+.5*(n.r*f+n.g*g),e=normalize(i-r),o=abs(x(i,e));m=vec4(o,1.);}
